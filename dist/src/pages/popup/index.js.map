{"version":3,"file":"index.js","sources":["../../../../src/pages/popup/popup.tsx","../../../../src/pages/popup/index.tsx"],"sourcesContent":["import * as React from 'react';\nimport './Popup.scss';\nimport { IBook } from '../../server/db/database';\nimport * as bookController from '../../server/controller/bookController';\nimport * as Code from '../../server/common/code';\nimport Book from '../../server/model/Book';\nimport { BookMode } from '../../server/enum/Book';\nimport { onDbUpdate } from '../../helper/db.helper';\nimport { isAutoSync } from '../../helper/sync';\nimport { noticeBg } from '../../helper/event';\nimport { APP_ACTIONS } from '../../common/constant';\n\ninterface AppProps {}\n\ninterface AppState {\n  currentBookId: number;\n  bookList: IBook[];\n}\n\nconst newTabUrl = chrome.runtime.getURL('newtab.html');\n\nexport default class Popup extends React.Component<AppProps, AppState> {\n  state = {\n    currentBookId: 0,\n    bookList: [],\n  };\n\n  constructor(props: AppProps, state: AppState) {\n    super(props, state);\n  }\n\n  loadBook(bookId) {\n    bookController.getList().then((resp) => {\n      if (resp.code === Code.OK.code) {\n        this.setState({\n          currentBookId: bookId,\n          bookList: resp.data,\n        });\n      }\n    });\n  }\n\n  componentDidMount() {\n    bookController.getCurrentBook().then((id) => {\n      this.loadBook(id);\n    });\n    onDbUpdate(() => {\n      if (isAutoSync()) {\n        noticeBg({\n          action: APP_ACTIONS.START_SYNC,\n        });\n      }\n    });\n  }\n\n  onBookClick(book) {\n    this.setState({\n      currentBookId: book.id,\n    });\n    bookController.setCurrentBook(book.id).then(() => {\n      console.log('save successfully!');\n    });\n  }\n\n  onBookDeleteClick(event, book: Book) {\n    event.stopPropagation();\n    event.preventDefault();\n\n    bookController.deleteBook(book.id).then((resp) => {\n      this.loadBook(this.state.currentBookId);\n    });\n  }\n\n  onBookOrderClick(event, book: Book, mode: number) {\n    event.stopPropagation();\n    event.preventDefault();\n\n    bookController.updateBook(book.id, { mode }).then((resp) => {\n      this.loadBook(this.state.currentBookId);\n      console.log(resp);\n    });\n  }\n\n  render() {\n    return (\n      <div className=\"popupContainer\">\n        <div className=\"app-title\">\n          <a className=\"logo-wrap\" href={newTabUrl} target=\"_blank\">\n            <i className=\"icon-app\"></i>\n            <div className=\"text\">Rambler</div>\n          </a>\n        </div>\n        {this.state.bookList.length ? (\n          <BookList\n            currentId={this.state.currentBookId}\n            list={this.state.bookList}\n            onBookClick={this.onBookClick.bind(this)}\n            onBookDeleteClick={this.onBookDeleteClick.bind(this)}\n            onBookOrderClick={this.onBookOrderClick.bind(this)}\n          ></BookList>\n        ) : (\n          <NoData />\n        )}\n      </div>\n    );\n  }\n}\n\nfunction NoData() {\n  const onClick = () => {\n    window.open(newTabUrl);\n  };\n  return (\n    <div className=\"nodata\">\n      <div className=\"msg\">No Data</div>\n      <button onClick={onClick} className=\"btn-add\">\n        + Add Book\n      </button>\n    </div>\n  );\n}\n\ninterface BookListProps {\n  list: IBook[];\n  currentId: number;\n  onBookClick: Function;\n  onBookDeleteClick: Function;\n  onBookOrderClick: Function;\n}\n\nclass BookList extends React.Component<BookListProps> {\n  render() {\n    return (\n      <div className=\"book-list\">\n        {this.props.list.map((book, index) => {\n          const className = ['book-item', book.id === this.props.currentId ? 'selected' : ''].join(' ');\n          return (\n            <div className={className} key={index} onClick={() => this.props.onBookClick(book)}>\n              {book.name.split('.')[0]}\n              <div className=\"icons\">\n                {book.mode === BookMode.INORDER ? (\n                  <img\n                    className=\"icon icon-order\"\n                    src=\"/img/icon/inorder.svg\"\n                    alt=\"\"\n                    onClick={(event) => this.props.onBookOrderClick(event, book, 0)}\n                  />\n                ) : (\n                  <img\n                    className=\"icon icon-order\"\n                    src=\"/img/icon/shuffle.svg\"\n                    alt=\"\"\n                    onClick={(event) => this.props.onBookOrderClick(event, book, 1)}\n                  />\n                )}\n                <img\n                  className=\"icon icon-close\"\n                  src=\"/img/icon/delete.svg\"\n                  alt=\"\"\n                  onClick={(event) => this.props.onBookDeleteClick(event, book)}\n                />\n              </div>\n            </div>\n          );\n        })}\n      </div>\n    );\n  }\n}\n","import * as React from 'react';\nimport * as ReactDOM from 'react-dom';\nimport Popup from './popup';\n\nchrome.tabs.query({ active: true, currentWindow: true }, (tab) => {\n  ReactDOM.render(<Popup />, document.getElementById('popup'));\n});\n"],"names":["newTabUrl","chrome","runtime","getURL","Popup","React","constructor","props","state","currentBookId","bookList","loadBook","bookId","getList","then","resp","code","Code","setState","data","componentDidMount","getCurrentBook","id","onDbUpdate","isAutoSync","noticeBg","action","APP_ACTIONS","START_SYNC","onBookClick","book","bookController","console","log","onBookDeleteClick","event","stopPropagation","preventDefault","onBookOrderClick","mode","updateBook","render","_jsx","length","BookList","bind","NoData","window","open","list","map","index","className","currentId","join","name","split","_jsxs","BookMode","INORDER","tabs","query","active","currentWindow","tab","document","getElementById"],"mappings":"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"}